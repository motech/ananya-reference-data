<databaseChangeLog

        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet context="setup" author="ThoughtWorks" id="1">
        <sql splitStatements="false">
            CREATE TABLE ananya_reference_data.location(
                id serial primary key,
                district varchar(255),
                block varchar(255),
                panchayat varchar(255),
                district_code int,
                block_code int,
                panchayat_code int
            );
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="2">
        <sql splitStatements="false">
            CREATE TABLE ananya_reference_data.front_line_worker(
                id serial,
                msisdn bigint,
                name varchar(255),
                designation varchar(30),
                location_id integer REFERENCES ananya_reference_data.location(id)
            );
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="3">
        <sql splitStatements="false">
            ALTER TABLE ananya_reference_data.front_line_worker ADD last_modified timestamp;
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="4">
        <sql splitStatements="false">
            ALTER TABLE ananya_reference_data.location ADD last_modified timestamp;
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="5">
        <sql splitStatements="false">
            CREATE TABLE ananya_reference_data.property(
                id serial primary key,
                name varchar(40),
                value varchar(40)
            );
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="6">
        <sql splitStatements="false">
            INSERT INTO ananya_reference_data.property(name,value) values('syncSwitch','on');
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="7">
        <sql splitStatements="false">
            ALTER TABLE  ananya_reference_data.location drop district_code;
            ALTER TABLE  ananya_reference_data.location drop block_code;
            ALTER TABLE  ananya_reference_data.location drop panchayat_code;
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="8">
        <!-- Following extension required to generate UUIDs. Assuming Postgres9.1 -->
        <sql splitStatements="false">
            CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        </sql>

        <sql splitStatements="false">
            ALTER TABLE ananya_reference_data.front_line_worker ADD COLUMN flw_guid VARCHAR(36);
            UPDATE ananya_reference_data.front_line_worker SET flw_guid = ((SELECT uuid_generate_v4() WHERE id=id));
            ALTER TABLE ananya_reference_data.front_line_worker ADD CONSTRAINT flw_guid_unique UNIQUE(flw_guid);
            ALTER TABLE ananya_reference_data.front_line_worker ALTER flw_guid SET NOT NULL;
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="9">
        <sql splitStatements="false">
            ALTER TABLE ananya_reference_data.front_line_worker ADD COLUMN verification_status VARCHAR(30);
            ALTER TABLE ananya_reference_data.front_line_worker ADD COLUMN reason VARCHAR(255);
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks" id="10">
        <sql splitStatements="false">
            ALTER TABLE ananya_reference_data.front_line_worker RENAME COLUMN flw_guid TO flw_id
        </sql>
    </changeSet>

</databaseChangeLog>